<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propuesta Mascota FIIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LIBRER√çAS DE EXPORTACI√ìN (Para PDF y Excel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 font-sans">
    <div id="app"></div>

    <script>
        // Configuraci√≥n de Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'unasam-blue': '#1e3a8a', 
                    }
                }
            }
        }
    </script>

    <script>
        // --- C√ìDIGO CL√ÅSICO (SOLO UI y DATA HOLDER) ---

        // FUNCIONES DE UTILIDAD (SVG ICONS)
        const Icons = {
            // Icono de la UNASAM (Escudo)
            Unasam: (classes = "w-10 h-10") => `
                <svg class="${classes}" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L3 6v6c0 5.5 4.5 10 9 10s9-4.5 9-10V6l-9-4zm0 2.23L19 7.5v4.5c0 4.14-3.5 7.5-7 7.5s-7-3.36-7-7.5V7.5l7-3.27z"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 11.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm0-3.5a1 1 0 100 2 1 1 0 000-2z"/>
                    <path d="M11 13h2v4h-2z"/>
                </svg>
            `,
            // Botarga de Sonic (Silueta)
            SonicBotarga: (classes = "w-10 h-10") => `
                <svg class="text-blue-500 ${classes}" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.5 2a.5.5 0 00-.45.71L17.2 6.5H12c-.55 0-1 .45-1 1s.45 1 1 1h4.25l-2.43 3.42a.5.5 0 00.4.88h3.33a.5.5 0 00.46-.71L18.79 8.5H20c.55 0 1-.45 1-1s-.45-1-1-1h-2.18l1.63-2.29a.5.5 0 00-.4-.88H15.5zM7.5 7a.5.5 0 000 1h-2a.5.5 0 000-1h2zM5.5 10a.5.5 0 000 1h2a.5.5 0 000-1h-2zM7.5 13a.5.5 0 000 1h-2a.5.5 0 000-1h2zM12 14c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1h-5zM12 17c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1h-5zM12 20c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1h-5z"/>
                </svg>
            `,
            Document: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m-5 8V8l6-6v6H8z"/></svg>`,
            Clipboard: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M17 17h.01"/></svg>`,
            Pen: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>`,
            Check: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`,
            Download: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>`,
        };


        const app = {
            signatures: [],
            isFirebaseReady: false,
            isLoading: true, // Estado de carga inicial (MANDATORIO)
            activeTab: 'propuesta',
            showDocument: null,

            // REFERENCIAS INTERNAS (Definidas por el m√≥dulo, aqu√≠ solo placeholders)
            // La versi√≥n final de estas funciones ser√° asignada por el script de m√≥dulo.
            add: function() { 
                if (!this.isFirebaseReady) {
                    this.showStatus('add-status', 'Base de datos no conectada. No se puede registrar la firma.', 'red');
                }
            },
            deleteSig: function(id) { 
                if (!this.isFirebaseReady) {
                    this.showStatus('add-status', 'Base de datos no conectada. No se puede eliminar la firma.', 'red');
                }
            },

            // Funci√≥n de utilidad para mostrar mensajes
            showStatus(elementId, message, color) {
                const statusDiv = document.getElementById(elementId);
                if (statusDiv) {
                    const icon = color === 'red' ? '‚ùå' : Icons.Check("w-5 h-5 mr-1");
                    const colorClass = color === 'red' ? 'text-red-600' : 'text-green-600';
                    statusDiv.innerHTML = `<span class="${colorClass} font-semibold flex items-center">${icon} ${message}</span>`;
                    setTimeout(() => { statusDiv.innerHTML = ''; }, color === 'red' ? 5000 : 3000);
                }
            },

            // FUNCI√ìN LLAMADA POR EL M√ìDULO PARA ACTUALIZAR DATOS
            loadDataAndRender(signaturesArray, isReady) {
                this.signatures = signaturesArray;
                this.isFirebaseReady = isReady;
                this.isLoading = false; 
                this.render();
            },

            switchTab(tab) { this.activeTab = tab; this.render(); },
            showDoc(doc) { 
                if (doc === 'firmas') {
                    this.switchTab('firmas');
                    this.showDocument = null; 
                } else {
                    this.showDocument = doc; 
                    this.render(); 
                }
            },
            closeDoc() { this.showDocument = null; this.render(); },

            // FUNCI√ìN DE CONTENIDO DE LA PROPUESTA (COMPLETO)
            getProposal() {
                const fecha = new Date().toLocaleDateString('es-PE', { year: 'numeric', month: 'long', day: 'numeric' });
                return `PROPUESTA DE INCORPORACI√ìN DE MASCOTA COMPLEMENTARIA
ESCUELA PROFESIONAL DE INGENIER√çA INDUSTRIAL
FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS (FIIA)
UNIVERSIDAD NACIONAL SANTIAGO ANT√öNEZ DE MAYOLO (UNASAM)

Huaraz, ${fecha}

SE√ëOR
DECANO DE LA FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS
PRESENTE.-

ASUNTO: Solicitud de incorporaci√≥n de la mascota "Sonic" como representante oficial de la Escuela Profesional de Ingenier√≠a Industrial, de manera complementaria a la mascota actual (Garfield).

Estimado Se√±or Decano,

Nos dirigimos a usted, los estudiantes de la Escuela Profesional de Ingenier√≠a Industrial, con el debido respeto para presentar formalmente esta solicitud.

1. ANTECEDENTES
Actualmente, nuestra facultad, FIIA, utiliza al personaje "Garfield" como su mascota representativa. Reconocemos y respetamos esta tradici√≥n que abarca a ambas escuelas. Sin embargo, en el contexto actual y las necesidades espec√≠ficas de identidad de la carrera de Ingenier√≠a Industrial, se hace necesario un s√≠mbolo complementario.

2. FUNDAMENTACI√ìN DE LA PROPUESTA
La Escuela Profesional de Ingenier√≠a Industrial requiere una mascota que, si bien coexista con Garfield, posea caracter√≠sticas que representen los valores fundamentales de nuestra disciplina, tales como:
    a) Velocidad y Eficiencia: Sonic el Erizo es mundialmente conocido por su velocidad. En Ingenier√≠a Industrial, la velocidad y la optimizaci√≥n de procesos (lograr m√°s en menos tiempo) son principios esenciales.
    b) Determinaci√≥n y Enfoque: Sonic es un personaje que siempre persigue sus objetivos con firmeza, simbolizando la planificaci√≥n y la gesti√≥n efectiva de proyectos.
    c) Imagen Moderna y Global: La Ingenier√≠a Industrial es una carrera moderna y universal. Sonic ofrece una imagen contempor√°nea que se alinea con la innovaci√≥n tecnol√≥gica y la globalizaci√≥n.

3. EL ROL COMPLEMENTARIO DE SONIC
Proponemos que Sonic no reemplace a Garfield, sino que se incorpore como la mascota oficial de la Escuela Profesional de Ingenier√≠a Industrial. Esto permitir√° a FIIA mantener a Garfield (cubriendo a ambas escuelas) y a Ingenier√≠a Industrial contar con Sonic, reforzando la identidad espec√≠fica sin dividir a la facultad.

4. CONSIDERACIONES FINALES
Agradecemos su tiempo y su consideraci√≥n a esta propuesta que busca enriquecer la identidad estudiantil y fomentar el sentido de pertenencia a trav√©s de un s√≠mbolo que resuene con los principios de nuestra carrera profesional. Adjuntamos a esta solicitud un registro de firmas de respaldo de la comunidad estudiantil.

Atentamente,

Comit√© de Estudiantes Promotores de la Mascota Sonic
(Ver Anexo: Registro de firmas de respaldo estudiantil)`;
            },

            // FUNCI√ìN DE CONTENIDO INFORMATIVO (CONTENIDO CORREGIDO Y PULIDO)
            getInfo() {
                return `DOCUMENTO INFORMATIVO: JUSTIFICACI√ìN DE LA MASCOTA SONIC

¬°√önete al Movimiento!

La Escuela Profesional de Ingenier√≠a Industrial busca una identidad que refleje la modernidad, eficiencia y dinamismo de nuestra carrera. Por eso, proponemos a Sonic el Erizo como nuestra mascota complementaria, coexistiendo con Garfield a nivel de facultad (FIIA).

VALORES DE INGENIER√çA INDUSTRIAL REFLEJADOS EN SONIC:

1. VELOCIDAD (OPTIMIZACI√ìN)
   - Principio Industrial: Maximizar la eficiencia, reducir tiempos y optimizar procesos de producci√≥n.
   - S√≠mbolo de Sonic: Conocido como el erizo m√°s r√°pido, encarna la b√∫squeda constante de la m√°xima productividad en el menor tiempo.

2. ANILLOS (GESTI√ìN DE RECURSOS)
   - Principio Industrial: Gestionar, proteger y maximizar el uso de recursos (materiales, financieros, humanos) en cualquier sistema productivo.
   - S√≠mbolo de Sonic: Los 'Rings' representan la riqueza y los recursos que deben ser recolectados y protegidos del desperdicio.

3. DERROTAR A EGGMAN (SOLUCI√ìN DE PROBLEMAS)
   - Principio Industrial: Identificar cuellos de botella y amenazas sist√©micas (riesgos, fallas) y aplicar la mejor estrategia para neutralizarlas.
   - S√≠mbolo de Sonic: Siempre encuentra la mejor ruta y la soluci√≥n m√°s efectiva para vencer al Dr. Eggman y restaurar el orden.

4. COLOR AZUL (LIDERAZGO Y CONFIANZA)
   - Principio Industrial: El liderazgo √©tico y la toma de decisiones basada en datos.
   - S√≠mbolo de Sonic: El azul se asocia con la inteligencia, la confianza y la seriedad, valores clave para el liderazgo organizacional.

CONCLUSI√ìN:
La propuesta de Sonic permite a FIIA mantener a Garfield (Ingenier√≠a de Industrias Alimentarias) y a Ingenier√≠a Industrial contar con un s√≠mbolo propio, reforzando la identidad de la carrera dentro de la unidad de la facultad.

üíô ¬°APOYA LA PROPUESTA FIRMANDO EN LA PESTA√ëA 'REGISTRO DE FIRMAS'!

---
ESCUELA PROFESIONAL DE INGENIER√çA INDUSTRIAL
FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS - UNASAM`;
            },
            
            // Funci√≥n de descarga principal (para documentos TXT)
            download(type, format) {
                let content = type === 'propuesta' ? this.getProposal() : this.getInfo();
                let filename = type === 'propuesta' ? 'Propuesta_Formal_FIIA' : 'Material_Informativo_FIIA';

                if (format === 'txt') {
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename + '.txt';
                    a.click();
                }
            },

            // FUNCI√ìN ESPECIALIZADA para descargar firmas en m√∫ltiples formatos
            downloadSignatures(format) {
                if (this.signatures.length === 0) {
                     document.getElementById('error-message-box').innerHTML = `
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative shadow-md" role="alert">
                            <span class="block sm:inline">No hay firmas registradas para descargar.</span>
                        </div>`;
                     setTimeout(() => document.getElementById('error-message-box').innerHTML = '', 4000);
                     return;
                }

                const wsData = [
                    ['N¬∞', 'C√ìDIGO', 'APELLIDOS Y NOMBRES', 'ESCUELA PROFESIONAL', 'CICLO', 'FECHA REGISTRO'],
                    ...this.signatures.map((s, i) => [
                        i + 1, 
                        s.codigo, 
                        s.nombre, 
                        s.escuela, 
                        s.ciclo, 
                        s.timestamp.toLocaleString('es-PE', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })
                    ])
                ];
                
                const filenameBase = "Registro_Firmas_Sonic_FIIA";

                if (format === 'xlsx') {
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Registro_Firmas");
                    XLSX.writeFile(wb, filenameBase + ".xlsx");
                } else if (format === 'pdf') {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'pt', 'a4');
                    const headers = [wsData[0]]; 
                    const body = wsData.slice(1); 
                    
                    doc.setFontSize(18);
                    doc.setTextColor(30, 64, 175); 
                    doc.text("Registro de Firmas - Propuesta Mascota Sonic FIIA", 40, 50);

                    doc.autoTable({
                        startY: 70,
                        head: headers,
                        body: body,
                        theme: 'grid',
                        headStyles: { fillColor: [30, 64, 175], fontStyle: 'bold' },
                        styles: { fontSize: 8, cellPadding: 3, overflow: 'linebreak' },
                    });

                    doc.save(filenameBase + ".pdf");
                } 
            },

            stats() {
                return {
                    total: this.signatures.length,
                    industrial: this.signatures.filter(s => s.escuela === 'Ingenier√≠a Industrial').length,
                    alimentarias: this.signatures.filter(s => s.escuela === 'Ingenier√≠a en Industrias Alimentarias').length
                };
            },

            render() {
                const stats = this.stats();
                document.getElementById('app').innerHTML = `
                    <!-- Mensaje de Error (Reemplazo de alert()) -->
                    <div id="error-message-box" class="fixed top-4 right-4 z-50 w-full max-w-sm"></div>

                    <div class="bg-gradient-to-r from-unasam-blue via-blue-800 to-blue-900 text-white shadow-2xl">
                        <div class="max-w-7xl mx-auto px-6 py-8">
                            <div class="flex items-start justify-between flex-wrap gap-4">
                                
                                <!-- PARTE IZQUIERDA: LOGO UNASAM Y TEXTO --><div class="flex items-start gap-4">
                                    <div class="bg-white/10 p-3 rounded-xl shadow-lg border-2 border-white/20">
                                        <!-- √çCONO DE UNASAM (Escudo) -->${Icons.Unasam("w-8 h-8 md:w-10 md:h-10")}
                                    </div>
                                    <div>
                                        <h1 class="text-xl md:text-3xl font-bold">UNASAM</h1>
                                        <p class="text-blue-200 text-sm mt-1">Universidad Nacional Santiago Ant√∫nez de Mayolo</p>
                                        <p class="text-blue-300 text-xs mt-1 font-semibold">Facultad de Ingenier√≠a de Industrias Alimentarias</p>
                                    </div>
                                </div>

                                <!-- PARTE DERECHA: ICONO SONIC (Botarga) --><div class="text-7xl self-start pt-1">
                                    ${Icons.SonicBotarga("w-12 h-12 md:w-16 md:h-16 text-blue-400")}
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-6 border-t border-blue-700">
                                <h2 class="text-xl md:text-2xl font-semibold">Propuesta de Incorporaci√≥n de Mascota Sonic</h2>
                                <p class="text-blue-200 text-sm mt-1">Escuela Profesional de Ingenier√≠a Industrial</p>
                            </div>
                        </div>
                    </div>

                    <div class="max-w-7xl mx-auto px-6 py-8">
                        
                        <!-- PESTA√ëAS DE NAVEGACI√ìN -->
                        <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
                            <div class="flex border-b">
                                <button onclick="app.switchTab('propuesta')" class="flex-1 px-6 py-4 font-semibold text-sm md:text-base transition-colors ${this.activeTab==='propuesta'?'bg-blue-600 text-white':'text-gray-600 hover:bg-gray-50'}">
                                    ${Icons.Document("w-5 h-5 inline-block mr-2")} Documentos
                                </button>
                                <button onclick="app.switchTab('firmas')" class="flex-1 px-6 py-4 font-semibold text-sm md:text-base transition-colors ${this.activeTab==='firmas'?'bg-blue-600 text-white':'text-gray-600 hover:bg-gray-50'}">
                                    ${Icons.Pen("w-5 h-5 inline-block mr-2")} Registro de Firmas
                                </button>
                            </div>
                        </div>
                        
                        <!-- CONTENIDO DE LA APLICACI√ìN -->
                        ${this.isLoading ? `
                            <!-- Indicador de Carga Mejorado (Sincronizaci√≥n en curso) -->
                            <div class="text-center py-20 text-blue-600 bg-white rounded-xl shadow-lg p-10">
                                <svg class="animate-spin h-10 w-10 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p class="font-bold text-xl text-blue-800">Sincronizando Firmas Compartidas...</p>
                                <p class="text-sm text-gray-600 mt-2">Estamos conectando con la base de datos Firestore para descargar todos los registros persistentes.</p>
                                ${!this.isFirebaseReady ? '<p class="text-xs mt-4 text-red-500 font-semibold">ADVERTENCIA: Fallo en la conexi√≥n de la base de datos compartida.</p>' : ''}
                            </div>
                        ` : 
                        this.activeTab === 'propuesta' ? `
                            <div class="space-y-8">
                                <div class="grid md:grid-cols-3 gap-6">
                                    <button onclick="app.showDoc('propuesta')" class="bg-white p-6 md:p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-blue-500 transform hover:scale-[1.01]">
                                        <div class="text-center">
                                            <div class="text-4xl md:text-5xl mb-3">üìÑ</div>
                                            <h3 class="font-bold text-lg md:text-xl mb-1">Propuesta Formal</h3>
                                            <p class="text-sm text-gray-600">Documento oficial para el Decanato</p>
                                        </div>
                                    </button>
                                    <button onclick="app.showDoc('info')" class="bg-white p-6 md:p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-green-500 transform hover:scale-[1.01]">
                                        <div class="text-center">
                                            <div class="text-4xl md:text-5xl mb-3">üìã</div>
                                            <h3 class="font-bold text-lg md:text-xl mb-1">Material Informativo</h3>
                                            <p class="text-sm text-gray-600">Para difusi√≥n estudiantil</p>
                                        </div>
                                    </button>
                                    <button onclick="app.showDoc('firmas')" class="bg-white p-6 md:p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-purple-500 transform hover:scale-[1.01]">
                                        <div class="text-center">
                                            <div class="text-4xl md:text-5xl mb-3">‚úçÔ∏è</div>
                                            <h3 class="font-bold text-lg md:text-xl mb-1">Hoja de Firmas</h3>
                                            <p class="text-sm text-gray-600">(${stats.total} firmas compartidas)</p>
                                        </div>
                                    </button>
                                </div>

                                <!-- VENTANA MODAL PARA DOCUMENTOS -->
                                ${this.showDocument ? `
                                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                                            <div class="p-6 md:p-8 border-b border-gray-200 flex justify-between items-center">
                                                <h3 class="font-bold text-xl md:text-2xl text-blue-800">
                                                    ${this.showDocument==='propuesta'?'üìÑ Propuesta Formal':''}
                                                    ${this.showDocument==='info'?'üìã Material Informativo':''}
                                                </h3>
                                                <button onclick="app.closeDoc()" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button>
                                            </div>
                                            
                                            <div class="p-6 md:p-8 overflow-y-auto flex-grow">
                                                <div class="bg-gray-50 p-4 md:p-6 rounded-lg border">
                                                    <pre class="whitespace-pre-wrap text-sm font-mono text-gray-700 leading-relaxed">${
                                                        this.showDocument==='propuesta'?this.getProposal():
                                                        this.showDocument==='info'?this.getInfo(): ''
                                                    }</pre>
                                                </div>
                                            </div>

                                            <div class="p-6 md:p-8 border-t border-gray-200 flex justify-end gap-3 flex-wrap">
                                                <button onclick="app.download('${this.showDocument}', 'txt')" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-md flex items-center">
                                                    ${Icons.Download("w-5 h-5 mr-2")} Descargar Documento (TXT)
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}

                                <div class="bg-blue-50 border-l-4 border-blue-600 p-6 md:p-8 rounded-xl shadow-md">
                                    <h3 class="font-bold text-lg mb-4 text-blue-800 flex items-center">
                                        ${Icons.Check("w-5 h-5 text-blue-600 mr-2")} Principios de la Propuesta
                                    </h3>
                                    <ul class="space-y-3 text-gray-700">
                                        <li><strong>1. Persistencia:</strong> Los registros se guardan en la nube (Firestore) y no localmente.</li>
                                        <li><strong>2. Sincronizaci√≥n:</strong> La lista de firmas se actualiza autom√°ticamente en todos los dispositivos usando el listener \`onSnapshot\`.</li>
                                        <li><strong>3. Unidad:</strong> La propuesta busca sumar una mascota (Sonic) sin reemplazar a la actual (Garfield), fomentando la colaboraci√≥n.</li>
                                    </ul>
                                </div>
                            </div>
                        ` : `
                            <!-- PESTA√ëA DE REGISTRO DE FIRMAS -->
                            <div class="space-y-8">
                                <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded mb-6" role="alert">
                                    <p class="font-bold">‚úÖ Base de Datos Compartida y en Tiempo Real (Firestore)</p>
                                    <p class="text-sm">Las ${stats.total} firmas se han cargado desde la base de datos **compartida** y son visibles para todos los usuarios. Cada nueva firma se sincroniza autom√°ticamente.</p>
                                </div>
                                
                                <div class="grid md:grid-cols-3 gap-6">
                                    <div class="bg-gradient-to-br from-blue-600 to-blue-700 text-white p-6 md:p-8 rounded-xl shadow-lg">
                                        <div class="text-4xl md:text-5xl font-bold">${stats.total}</div>
                                        <div class="text-lg">Total de Firmas</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-600 to-green-700 text-white p-6 md:p-8 rounded-xl shadow-lg">
                                        <div class="text-4xl md:text-5xl font-bold">${stats.industrial}</div>
                                        <div class="text-lg">Ing. Industrial</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-600 to-purple-700 text-white p-6 md:p-8 rounded-xl shadow-lg">
                                        <div class="text-4xl md:text-5xl font-bold">${stats.alimentarias}</div>
                                        <div class="text-lg">Ing. Alimentarias</div>
                                    </div>
                                </div>

                                <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border-t-4 border-blue-600">
                                    <h3 class="font-bold text-xl md:text-2xl mb-4 text-blue-800">1. Agregar Nueva Firma Digital</h3>
                                    <div class="grid md:grid-cols-5 gap-4 mb-4">
                                        <input type="text" id="codigo" placeholder="C√≥digo" class="px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                        <input type="text" id="nombre" placeholder="Apellidos y Nombres" class="md:col-span-2 px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                        <select id="escuela" class="px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                            <option value="Ingenier√≠a Industrial">Ingenier√≠a Industrial</option>
                                            <option value="Ingenier√≠a en Industrias Alimentarias">Ingenier√≠a en Industrias Alimentarias</option>
                                        </select>
                                        <input type="text" id="ciclo" placeholder="Ciclo" class="px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                    </div>
                                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                        <!-- ESTE BOT√ìN LLAMA A LA FUNCI√ìN SOBREESCRITA DEL M√ìDULO -->
                                        <button onclick="app.add()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-semibold transition-colors w-full md:w-auto shadow-md">
                                            ‚ûï Registrar Firma
                                        </button>
                                        <div id="add-status" class="h-8 flex items-center text-sm"></div>
                                    </div>
                                    
                                    <h3 class="font-bold text-xl md:text-2xl mt-10 mb-4 text-blue-800">2. Descargar Padr√≥n Oficial</h3>
                                    <div class="flex flex-wrap gap-4">
                                        <button onclick="app.downloadSignatures('xlsx')" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold shadow-md flex items-center">
                                            ${Icons.Download("w-5 h-5 mr-2")} Descargar Excel (.xlsx)
                                        </button>
                                        <button onclick="app.downloadSignatures('pdf')" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-semibold shadow-md flex items-center">
                                            ${Icons.Download("w-5 h-5 mr-2")} Descargar PDF (.pdf)
                                        </button>
                                    </div>
                                </div>

                                <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                                    <table class="w-full min-w-max">
                                        <thead class="bg-gray-100 border-b-2 border-gray-200">
                                            <tr>
                                                <th class="px-6 py-4 text-left font-bold text-sm">N¬∞</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">C√≥digo</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Nombres</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Escuela</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Ciclo</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Fecha Registro</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Acci√≥n</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${this.signatures.length === 0 ? `
                                                <tr><td colspan="7" class="px-6 py-12 text-center text-gray-500">
                                                    <div class="text-4xl md:text-5xl mb-3">üìù</div>
                                                    <p>No hay firmas registradas a√∫n. ¬°Los datos son **persistentes** y **compartidos**!</p>
                                                    <p class="text-sm mt-1">Agrega la primera firma arriba</p>
                                                </td></tr>
                                            ` : this.signatures.map((s, i) => `
                                                <tr class="border-t hover:bg-blue-50 transition-colors">
                                                    <td class="px-6 py-4 text-sm">${i+1}</td>
                                                    <td class="px-6 py-4 text-sm">${s.codigo}</td>
                                                    <td class="px-6 py-4 text-sm">${s.nombre}</td>
                                                    <td class="px-6 py-4 text-xs font-semibold ${s.escuela === 'Ingenier√≠a Industrial' ? 'text-blue-600' : 'text-green-600'}">${s.escuela}</td>
                                                    <td class="px-6 py-4 text-sm">${s.ciclo}</td>
                                                    <td class="px-6 py-4 text-xs text-gray-500">${s.timestamp.toLocaleString('es-PE', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</td>
                                                    <td class="px-6 py-4">
                                                        <!-- ESTE BOT√ìN LLAMA A LA FUNCI√ìN SOBREESCRITA DEL M√ìDULO -->
                                                        <button onclick="app.deleteSig('${s.id}')" class="text-red-500 hover:text-red-700 transition-colors" title="Eliminar firma">üóëÔ∏è</button>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        `}
                    </div>
                `;
            }
        };

        // Renderiza el estado de carga inicial
        app.render();

    </script>

    <!-- FIREBASE SETUP - M√≥dulo para la inicializaci√≥n y el listener -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, serverTimestamp, addDoc, deleteDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        let db, signaturesRef;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        async function initFirebase() {
            const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
            
            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config not available. Running in local mode (no persistence).");
                app.loadDataAndRender([], false);
                return;
            }

            try {
                setLogLevel('Debug'); 
                const appInstance = initializeApp(firebaseConfig);
                
                db = getFirestore(appInstance);
                const auth = getAuth(appInstance);
                
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // USO DEL PATH PUBLICO COMPARTIDO: artifacts/{appId}/public/data/signatures
                signaturesRef = collection(db, `artifacts/${appId}/public/data/signatures`);
                
                // 1. SOBREESCRIBIR app.add() con la versi√≥n del m√≥dulo
                app.add = handleDbAdd;
                // 2. SOBREESCRIBIR app.deleteSig() con la versi√≥n del m√≥dulo
                app.deleteSig = handleDbDelete;

                // Iniciar listener en tiempo real (onSnapshot)
                onSnapshot(
                    query(signaturesRef), 
                    (snapshot) => {
                        const signaturesArray = [];
                        snapshot.forEach((d) => {
                            const data = d.data();
                            signaturesArray.push({
                                id: d.id,
                                codigo: data.codigo || 'N/A',
                                nombre: data.nombre || 'N/A',
                                escuela: data.escuela || 'N/A',
                                ciclo: data.ciclo || 'N/A',
                                timestamp: data.timestamp ? data.timestamp.toDate() : new Date(0) 
                            });
                        });
                        
                        signaturesArray.sort((a, b) => a.timestamp - b.timestamp);
                        app.loadDataAndRender(signaturesArray, true); // Pasar true para indicar que est√° listo

                    }, 
                    (error) => {
                        console.error("Error al obtener firmas de Firestore:", error);
                        app.loadDataAndRender([], false);
                    }
                );

            } catch (error) {
                console.error("Error de Firebase Auth o Init:", error);
                app.loadDataAndRender([], false);
            }
        }

        // --- MANEJADORES DE BASE DE DATOS DENTRO DEL M√ìDULO (USAN IMPORTS INTERNAMENTE) ---

        async function handleDbAdd() {
            const codigo = document.getElementById('codigo').value.trim();
            const nombre = document.getElementById('nombre').value.trim();
            const escuela = document.getElementById('escuela').value;
            const ciclo = document.getElementById('ciclo').value.trim();
            
            if (codigo && nombre && ciclo) {
                try {
                    await addDoc(signaturesRef, {
                        codigo,
                        nombre,
                        escuela,
                        ciclo,
                        timestamp: serverTimestamp() 
                    });
                    
                    app.showStatus('add-status', 'Firma registrada exitosamente y COMPARTIDA.', 'green');
                } catch (e) {
                    console.error("Error al a√±adir documento: ", e);
                    app.showStatus('add-status', `Error al guardar: ${e.message || 'Desconocido'}`, 'red');
                }
                
                // Limpiar campos
                document.getElementById('codigo').value = '';
                document.getElementById('nombre').value = '';
                document.getElementById('ciclo').value = '';
            } else {
                app.showStatus('add-status', 'Debe completar todos los campos.', 'red');
            }
        }

        async function handleDbDelete(id) { 
            if (!id || !db) return;
            try {
                const docRef = doc(db, `artifacts/${appId}/public/data/signatures`, id);
                await deleteDoc(docRef);
                // onSnapshot se encarga de actualizar la UI
            } catch (e) {
                console.error("Error al eliminar documento: ", e);
            }
        }

        // Inicializa Firebase al cargar el m√≥dulo
        initFirebase();
    </script>
</body>
</html>
