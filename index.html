<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propuesta Mascota Sonic - UNASAM FIIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LIBRER√çAS DE FIREBASE (Para persistencia de datos) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, deleteDoc, onSnapshot, collection, query, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Exponemos las funciones de Firebase al √°mbito global para poder usarlas en el script principal
        window.firebase = { 
            initializeApp, 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            getFirestore, 
            doc, 
            deleteDoc, 
            onSnapshot, 
            collection, 
            query, 
            addDoc,
            serverTimestamp
        };
    </script>
    
    <!-- LIBRER√çAS DE EXPORTACI√ìN (Para PDF y Excel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 font-sans">
    <div id="app"></div>

    <script>
        // Configuraci√≥n de Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'unasam-blue': '#1e3a8a', 
                    }
                }
            }
        }
    </script>

    <script>
        // FUNCIONES DE UTILIDAD (SVG ICONS)
        const Icons = {
            // Icono de la UNASAM (Escudo)
            Unasam: (classes = "w-10 h-10") => `
                <svg class="${classes}" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L3 6v6c0 5.5 4.5 10 9 10s9-4.5 9-10V6l-9-4zm0 2.23L19 7.5v4.5c0 4.14-3.5 7.5-7 7.5s-7-3.36-7-7.5V7.5l7-3.27z"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 11.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm0-3.5a1 1 0 100 2 1 1 0 000-2z"/>
                    <path d="M11 13h2v4h-2z"/>
                </svg>
            `,
            // Botarga de Sonic (Silueta)
            SonicBotarga: (classes = "w-10 h-10") => `
                <svg class="text-blue-500 ${classes}" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.5 2a.5.5 0 00-.45.71L17.2 6.5H12c-.55 0-1 .45-1 1s.45 1 1 1h4.25l-2.43 3.42a.5.5 0 00.4.88h3.33a.5.5 0 00.46-.71L18.79 8.5H20c.55 0 1-.45 1-1s-.45-1-1-1h-2.18l1.63-2.29a.5.5 0 00-.4-.88H15.5zM7.5 7a.5.5 0 000 1h-2a.5.5 0 000-1h2zM5.5 10a.5.5 0 000 1h2a.5.5 0 000-1h-2zM7.5 13a.5.5 0 000 1h-2a.5.5 0 000-1h2zM12 14c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1h-5zM12 17c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1h-5zM12 20c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1s-.45-1-1-1h-5z"/>
                </svg>
            `,
            Document: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m-5 8V8l6-6v6H8z"/></svg>`,
            Clipboard: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M17 17h.01"/></svg>`,
            Pen: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>`,
            Check: (classes = "w-6 h-6") => `<svg class="${classes}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`,
        };


        const app = {
            signatures: [],
            db: null,
            auth: null,
            signaturesRef: null,
            unsubscribe: null,
            userId: null,
            isFirebaseReady: false,
            isLoading: true, // Estado de carga inicial
            currentEntry: { codigo: '', nombre: '', escuela: 'Ingenier√≠a Industrial', ciclo: '' },
            activeTab: 'propuesta',
            showDocument: null,

            async init() { 
                // 1. FIREBASE SETUP
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

                if (Object.keys(firebaseConfig).length === 0 || typeof window.firebase === 'undefined') {
                     console.error("Firebase config or SDK not available. Running in local mode (no persistence).");
                     this.isFirebaseReady = false;
                     this.isLoading = false;
                } else {
                    const appInstance = firebase.initializeApp(firebaseConfig);
                    this.db = firebase.getFirestore(appInstance);
                    this.auth = firebase.getAuth(appInstance);
                    this.isFirebaseReady = true;

                    try {
                        // Autenticaci√≥n: con token si est√° disponible, sino an√≥nima.
                        if (typeof __initial_auth_token !== 'undefined') {
                            await firebase.signInWithCustomToken(this.auth, __initial_auth_token);
                        } else {
                            await firebase.signInAnonymously(this.auth);
                        }
                        this.userId = this.auth.currentUser?.uid || crypto.randomUUID();
                        
                        // Ruta p√∫blica para la colecci√≥n de firmas
                        this.signaturesRef = firebase.collection(this.db, `artifacts/${appId}/public/data/signatures`);
                        
                        // 2. LISTENER EN TIEMPO REAL (onSnapshot)
                        this.unsubscribe = firebase.onSnapshot(firebase.query(this.signaturesRef), (snapshot) => {
                            const signaturesArray = [];
                            snapshot.forEach((doc) => {
                                const data = doc.data();
                                // Se a√±ade 'id' de Firestore, y se usa la marca de tiempo para ordenar despu√©s
                                signaturesArray.push({
                                    id: doc.id,
                                    codigo: data.codigo || 'N/A',
                                    nombre: data.nombre || 'N/A',
                                    escuela: data.escuela || 'N/A',
                                    ciclo: data.ciclo || 'N/A',
                                    timestamp: data.timestamp ? data.timestamp.toDate() : new Date(0) 
                                });
                            });
                            // Ordenar las firmas por fecha (de la m√°s antigua a la m√°s reciente)
                            signaturesArray.sort((a, b) => a.timestamp - b.timestamp);
                            
                            this.signatures = signaturesArray;
                            this.isLoading = false;
                            this.render();
                        }, (error) => {
                            console.error("Error al obtener firmas de Firestore:", error);
                            this.isLoading = false;
                            this.render();
                        });

                    } catch (error) {
                        console.error("Error de Firebase Auth o Init:", error);
                        this.isLoading = false;
                    }
                }
                
                // Render inicial para mostrar el estado de carga
                this.render();
            },

            switchTab(tab) { this.activeTab = tab; this.render(); },
            showDoc(doc) { this.showDocument = doc; this.render(); },
            closeDoc() { this.showDocument = null; this.render(); },

            async add() {
                const codigo = document.getElementById('codigo').value.trim();
                const nombre = document.getElementById('nombre').value.trim();
                const escuela = document.getElementById('escuela').value;
                const ciclo = document.getElementById('ciclo').value.trim();
                
                if (codigo && nombre && ciclo) {
                    if (this.isFirebaseReady) {
                        try {
                            // Usar addDoc para guardar en Firestore
                            await firebase.addDoc(this.signaturesRef, {
                                codigo,
                                nombre,
                                escuela,
                                ciclo,
                                timestamp: firebase.serverTimestamp() // Marca de tiempo del servidor
                            });
                            // onSnapshot se encarga de actualizar this.signatures y this.render()
                        } catch (e) {
                            console.error("Error al a√±adir documento: ", e);
                        }
                    } else {
                        // Modo sin persistencia (solo para desarrollo local sin Firebase)
                        this.signatures.push({ id: Date.now(), codigo, nombre, escuela, ciclo, timestamp: new Date() });
                        this.render();
                    }
                    
                    // Limpiar campos de entrada
                    document.getElementById('codigo').value = '';
                    document.getElementById('nombre').value = '';
                    document.getElementById('ciclo').value = '';
                } else {
                    // Reemplazo de alert()
                    console.error("Faltan datos para registrar la firma.");
                }
            },

            async deleteSig(id) { 
                if (this.isFirebaseReady) {
                    try {
                        const docRef = firebase.doc(this.db, `artifacts/${__app_id}/public/data/signatures`, id);
                        await firebase.deleteDoc(docRef);
                        // onSnapshot se encarga de actualizar this.signatures y this.render()
                    } catch (e) {
                        console.error("Error al eliminar documento: ", e);
                    }
                } else {
                    // Modo local
                    this.signatures = this.signatures.filter(s => s.id !== id); 
                    this.render();
                }
            },

            getProposal() {
                const fecha = new Date().toLocaleDateString('es-PE', { year: 'numeric', month: 'long', day: 'numeric' });
                return `PROPUESTA DE INCORPORACI√ìN DE MASCOTA COMPLEMENTARIA
ESCUELA PROFESIONAL DE INGENIER√çA INDUSTRIAL

UNIVERSIDAD NACIONAL SANTIAGO ANT√öNEZ DE MAYOLO - UNASAM
FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS

Huaraz, ${fecha}

SE√ëOR:
_________________________________
DECANO DE LA FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS

ASUNTO: Propuesta de incorporaci√≥n de mascota "Sonic" como s√≠mbolo complementario de la Escuela Profesional de Ingenier√≠a Industrial

De nuestra consideraci√≥n:

Por medio de la presente, los estudiantes de la Escuela Profesional de Ingenier√≠a Industrial nos dirigimos a usted con el debido respeto para exponer lo siguiente:

I. ANTECEDENTES

1.1. La Facultad de Ingenier√≠a de Industrias Alimentarias (FIIA) cuenta con la mascota "Garfield" como s√≠mbolo representativo de toda la facultad, misma que ha generado identidad y cohesi√≥n entre ambas escuelas profesionales.

1.2. La Escuela Profesional de Ingenier√≠a Industrial, consciente de su crecimiento acad√©mico y estudiantil, busca fortalecer su identidad particular sin menoscabar la unidad facultativa existente.

1.3. En otras facultades de la UNASAM y universidades nacionales, coexisten mascotas complementarias que representan a diferentes escuelas profesionales sin generar divisi√≥n, sino enriquecimiento cultural e identitario.

II. JUSTIFICACI√ìN

2.1. FORTALECIMIENTO DE IDENTIDAD PROPIA
La mascota "Sonic" representa valores inherentes a la Ingenier√≠a Industrial: velocidad en procesos, innovaci√≥n tecnol√≥gica, dinamismo y eficiencia. Estos atributos resuenan con el perfil del ingeniero industrial moderno.

2.2. UNIDAD EN LA DIVERSIDAD
La incorporaci√≥n de Sonic NO busca reemplazar a Garfield ni generar separaci√≥n. Al contrario, el concepto es que ambas mascotas sean "amigas" y convivan, reflejando la colaboraci√≥n entre ambas escuelas profesionales dentro de una misma facultad fuerte y unida.

2.3. MAYOR PARTICIPACI√ìN ESTUDIANTIL
Una mascota propia incrementar√° el sentido de pertenencia de los estudiantes de Ingenier√≠a Industrial, motivando mayor participaci√≥n en eventos acad√©micos, culturales y deportivos tanto internos como interfacultativos.

2.4. PROYECCI√ìN Y CRECIMIENTO
Como facultad que aspira al crecimiento y reconocimiento institucional, la diversificaci√≥n de s√≠mbolos identitarios contribuye al posicionamiento de nuestras escuelas profesionales, atrayendo a futuros estudiantes.

III. OBJETIVOS

3.1. Incorporar a "Sonic" como mascota oficial de la Escuela Profesional de Ingenier√≠a Industrial.
3.2. Mantener a "Garfield" como mascota representativa de toda la FIIA.
3.3. Promover actividades conjuntas donde ambas mascotas simbolicen la unidad facultativa.
3.4. Fortalecer la identidad estudiantil sin fragmentar la cohesi√≥n interfacultativa.

IV. RESPALDO ESTUDIANTIL

4.1. La presente propuesta cuenta con el respaldo documentado de estudiantes de AMBAS escuelas profesionales (Ingenier√≠a Industrial e Ingenier√≠a en Industrias Alimentarias), conforme a las firmas anexas.

4.2. Este apoyo transversal demuestra que la iniciativa es percibida como integradora y no divisoria por la comunidad estudiantil de la FIIA.

V. COMPROMISO

Los estudiantes de Ingenier√≠a Industrial nos comprometemos a:
- Financiar la elaboraci√≥n de la botarga de Sonic con recursos propios.
- Promover actividades donde ambas mascotas interact√∫en positivamente.
- Respetar y mantener a Garfield como s√≠mbolo facultativo principal.
- Contribuir al prestigio y unidad de la FIIA.

VI. SOLICITUD

Por lo expuesto, solicitamos respetuosamente se apruebe la incorporaci√≥n de "Sonic" como mascota complementaria de la Escuela Profesional de Ingenier√≠a Industrial, bajo los principios de unidad, respeto y crecimiento institucional aqu√≠ descritos.

Sin otro particular, quedamos de usted.

Atentamente,

_______________________________
ESTUDIANTES DE LA ESCUELA PROFESIONAL DE INGENIER√çA INDUSTRIAL
FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS - UNASAM

Anexo: Registro de firmas de respaldo estudiantil`;
            },

            getInfo() {
                return `¬øPOR QU√â SONIC COMO MASCOTA DE INGENIER√çA INDUSTRIAL?

Estimado(a) estudiante de la FIIA:

Te invitamos a conocer y apoyar esta iniciativa que busca FORTALECER nuestra facultad, NO dividirla.

üîµ ¬øQU√â PROPONEMOS?
Incorporar a SONIC como mascota de la Escuela Profesional de Ingenier√≠a Industrial, siendo el "amigo" de Garfield, nuestra mascota facultativa.

ü§ù ¬øSIGNIFICA SEPARARNOS?
¬°NO! Garfield seguir√° siendo la mascota de TODA la FIIA. Sonic ser√° un s√≠mbolo ADICIONAL para Industrial, conviviendo ambos en armon√≠a.

‚ö° ¬øPOR QU√â SONIC?
‚úì Representa velocidad ‚Üí Eficiencia en procesos industriales
‚úì Representa innovaci√≥n ‚Üí Tecnolog√≠a e ingenier√≠a moderna
‚úì Representa dinamismo ‚Üí El perfil del ingeniero industrial
‚úì Es reconocible y genera identificaci√≥n estudiantil

üéØ BENEFICIOS PARA LA FIIA COMPLETA:
‚Ä¢ Mayor participaci√≥n en eventos acad√©micos y deportivos
‚Ä¢ Fortalecimiento de identidad sin fragmentaci√≥n
‚Ä¢ Actividades conjuntas entre ambas escuelas (Sonic + Garfield)
‚Ä¢ Atracci√≥n de nuevos estudiantes a nuestra facultad
‚Ä¢ Proyecci√≥n institucional de la FIIA

üìã ¬øC√ìMO PUEDES APOYAR?
Firma en el registro estudiantil. Tu apoyo es importante sea que estudies Ingenier√≠a Industrial o Ingenier√≠a en Industrias Alimentarias.

Esta propuesta fue presentada al se√±or Decano, quien acept√≥ siempre que cuente con respaldo estudiantil documentado. ¬°Tu firma cuenta!

üíô JUNTOS SOMOS M√ÅS FUERTES
Sonic + Garfield = Una FIIA unida y con identidades claras

---
ESCUELA PROFESIONAL DE INGENIER√çA INDUSTRIAL
FACULTAD DE INGENIER√çA DE INDUSTRIAS ALIMENTARIAS - UNASAM`;
            },
            
            // Funci√≥n de descarga principal (para documentos TXT)
            download(type, format) {
                if (type === 'firmas') {
                    // Las firmas se manejan en downloadSignatures, esta funci√≥n ya no las necesita
                    return;
                }
                
                // L√≥gica de descarga de documentos (Propuesta/Info)
                let content = type === 'propuesta' ? this.getProposal() : this.getInfo();
                let filename = type === 'propuesta' ? 'Propuesta_Formal_FIIA' : 'Material_Informativo_FIIA';

                if (format === 'txt') {
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename + '.txt';
                    a.click();
                }
                // Los documentos complejos (Propuesta/Info) no se exportan f√°cilmente a PDF/Excel sin plantillas
            },

            // NUEVA FUNCI√ìN ESPECIALIZADA para descargar firmas en m√∫ltiples formatos
            downloadSignatures(format) {
                const wsData = [
                    ['N¬∞', 'C√ìDIGO', 'APELLIDOS Y NOMBRES', 'ESCUELA PROFESIONAL', 'CICLO', 'ID Digital (Para control interno)'],
                    ...this.signatures.map((s, i) => [i + 1, s.codigo, s.nombre, s.escuela, s.ciclo, s.id])
                ];
                
                const filenameBase = "Firmas_Sonic_FIIA";

                if (format === 'xlsx' || format === 'csv') {
                    // 1. EXCEL/XLSX/CSV DOWNLOAD
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Registro_Firmas");
                    
                    if (format === 'csv') {
                        XLSX.writeFile(wb, filenameBase + ".csv");
                    } else { // XLSX
                        XLSX.writeFile(wb, filenameBase + ".xlsx");
                    }
                } else if (format === 'pdf') {
                    // 2. PDF DOWNLOAD (Usando jspdf y autotable)
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'pt', 'a4');
                    // Usar solo las primeras 5 columnas para la presentaci√≥n en PDF
                    const headers = [wsData[0].slice(0, 5)]; 
                    const body = wsData.slice(1).map(row => row.slice(0, 5)); 
                    
                    doc.setFontSize(18);
                    doc.setTextColor(30, 64, 175); // Azul UNASAM
                    doc.text("Registro de Firmas - Propuesta Mascota Sonic FIIA", 40, 50);

                    doc.autoTable({
                        startY: 70,
                        head: headers,
                        body: body,
                        theme: 'grid',
                        headStyles: { fillColor: [30, 64, 175], fontStyle: 'bold' },
                        styles: { fontSize: 8, cellPadding: 3, overflow: 'linebreak' },
                    });

                    doc.save(filenameBase + ".pdf");
                } else if (format === 'txt') {
                    // 3. TEXTO TXT
                    const content = wsData.map(r => r.join('\t')).join('\n');
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = filenameBase + '.txt'; a.click();
                }
            },

            stats() {
                return {
                    total: this.signatures.length,
                    industrial: this.signatures.filter(s => s.escuela === 'Ingenier√≠a Industrial').length,
                    alimentarias: this.signatures.filter(s => s.escuela === 'Ingenier√≠a en Industrias Alimentarias').length
                };
            },

            render() {
                const stats = this.stats();
                document.getElementById('app').innerHTML = `
                    <div class="bg-gradient-to-r from-unasam-blue via-blue-800 to-blue-900 text-white shadow-2xl">
                        <div class="max-w-7xl mx-auto px-6 py-8">
                            <div class="flex items-start justify-between flex-wrap gap-4">
                                
                                <!-- PARTE IZQUIERDA: LOGO UNASAM Y TEXTO --><div class="flex items-start gap-4">
                                    <div class="bg-white/10 p-3 rounded-xl shadow-lg border-2 border-white/20">
                                        <!-- √çCONO DE UNASAM (Escudo) -->${Icons.Unasam("w-8 h-8 md:w-10 md:h-10")}
                                    </div>
                                    <div>
                                        <h1 class="text-xl md:text-3xl font-bold">UNASAM</h1>
                                        <p class="text-blue-200 text-sm mt-1">Universidad Nacional Santiago Ant√∫nez de Mayolo</p>
                                        <p class="text-blue-300 text-xs mt-1 font-semibold">Facultad de Ingenier√≠a de Industrias Alimentarias</p>
                                    </div>
                                </div>

                                <!-- PARTE DERECHA: ICONO SONIC (Botarga) --><div class="text-7xl self-start pt-1">
                                    ${Icons.SonicBotarga("w-12 h-12 md:w-16 md:h-16 text-blue-400")}
                                </div>
                            </div>
                            
                            <div class="mt-6 pt-6 border-t border-blue-700">
                                <h2 class="text-xl md:text-2xl font-semibold">Propuesta de Incorporaci√≥n de Mascota Sonic</h2>
                                <p class="text-blue-200 text-sm mt-1">Escuela Profesional de Ingenier√≠a Industrial</p>
                            </div>
                        </div>
                    </div>

                    <div class="max-w-7xl mx-auto px-6 py-8">
                        
                        <!-- PESTA√ëAS DE NAVEGACI√ìN -->
                        <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
                            <div class="flex border-b">
                                <button onclick="app.switchTab('propuesta')" class="flex-1 px-6 py-4 font-semibold text-sm md:text-base transition-colors ${this.activeTab==='propuesta'?'bg-blue-600 text-white':'text-gray-600 hover:bg-gray-50'}">
                                    ${Icons.Document("w-5 h-5 inline-block mr-2")} Documentos
                                </button>
                                <button onclick="app.switchTab('firmas')" class="flex-1 px-6 py-4 font-semibold text-sm md:text-base transition-colors ${this.activeTab==='firmas'?'bg-blue-600 text-white':'text-gray-600 hover:bg-gray-50'}">
                                    ${Icons.Pen("w-5 h-5 inline-block mr-2")} Registro de Firmas
                                </button>
                            </div>
                        </div>
                        
                        <!-- CONTENIDO DE LA APLICACI√ìN -->
                        ${this.isLoading ? `
                            <div class="text-center py-20 text-blue-600 bg-white rounded-xl shadow-lg p-10">
                                <svg class="animate-spin h-10 w-10 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p class="font-semibold text-lg">Cargando datos de firmas persistentes...</p>
                                <p class="text-sm text-gray-500 mt-2">Aseg√∫rate de tener conexi√≥n a Internet para la base de datos.</p>
                            </div>
                        ` : 
                        this.activeTab === 'propuesta' ? `
                            <div class="space-y-8">
                                <div class="grid md:grid-cols-3 gap-6">
                                    <button onclick="app.showDoc('propuesta')" class="bg-white p-6 md:p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-blue-500 transform hover:scale-[1.01]">
                                        <div class="text-center">
                                            <div class="text-4xl md:text-5xl mb-3">üìÑ</div>
                                            <h3 class="font-bold text-lg md:text-xl mb-1">Propuesta Formal</h3>
                                            <p class="text-sm text-gray-600">Documento oficial para el Decanato</p>
                                        </div>
                                    </button>
                                    <button onclick="app.showDoc('info')" class="bg-white p-6 md:p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-green-500 transform hover:scale-[1.01]">
                                        <div class="text-center">
                                            <div class="text-4xl md:text-5xl mb-3">üìã</div>
                                            <h3 class="font-bold text-lg md:text-xl mb-1">Material Informativo</h3>
                                            <p class="text-sm text-gray-600">Para difusi√≥n estudiantil</p>
                                        </div>
                                    </button>
                                    <button onclick="app.showDoc('firmas')" class="bg-white p-6 md:p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-purple-500 transform hover:scale-[1.01]">
                                        <div class="text-center">
                                            <div class="text-4xl md:text-5xl mb-3">‚úçÔ∏è</div>
                                            <h3 class="font-bold text-lg md:text-xl mb-1">Hoja de Firmas</h3>
                                            <p class="text-sm text-gray-600">${stats.total} firmas registradas (¬°Persistentes!)</p>
                                        </div>
                                    </button>
                                </div>

                                <!-- VENTANA MODAL PARA DOCUMENTOS -->
                                ${this.showDocument ? `
                                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                                            <div class="p-6 md:p-8 border-b border-gray-200 flex justify-between items-center">
                                                <h3 class="font-bold text-xl md:text-2xl text-blue-800">
                                                    ${this.showDocument==='propuesta'?'üìÑ Propuesta Formal':''}
                                                    ${this.showDocument==='info'?'üìã Material Informativo':''}
                                                    ${this.showDocument==='firmas'?'‚úçÔ∏è Formato de Firmas':''}
                                                </h3>
                                                <button onclick="app.closeDoc()" class="text-gray-500 hover:text-gray-700 text-3xl leading-none">&times;</button>
                                            </div>
                                            
                                            <div class="p-6 md:p-8 overflow-y-auto flex-grow">
                                                <div class="bg-gray-50 p-4 md:p-6 rounded-lg border">
                                                    <pre class="whitespace-pre-wrap text-sm font-mono text-gray-700 leading-relaxed">${
                                                        this.showDocument==='propuesta'?this.getProposal():
                                                        this.showDocument==='info'?this.getInfo():
                                                        [['N¬∞','C√ìDIGO','NOMBRES','ESCUELA','CICLO','FECHA REGISTRO'],...this.signatures.map((s,i)=>[i+1,s.codigo,s.nombre,s.escuela,s.ciclo,s.timestamp.toLocaleDateString('es-PE', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })])].map(r=>r.join('\t')).join('\n')
                                                    }</pre>
                                                </div>
                                            </div>

                                            <div class="p-6 md:p-8 border-t border-gray-200 flex justify-end gap-3 flex-wrap">
                                                ${this.showDocument === 'firmas' ? `
                                                    <p class="font-semibold text-gray-700 self-center mr-4">Exportar Firmas a:</p>
                                                    <button onclick="app.downloadSignatures('xlsx')" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold shadow-md">
                                                        üìä Excel (.xlsx)
                                                    </button>
                                                    <button onclick="app.downloadSignatures('pdf')" class="bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition-colors font-semibold shadow-md">
                                                        üì∞ PDF (.pdf)
                                                    </button>
                                                    <button onclick="app.downloadSignatures('txt')" class="bg-gray-600 text-white px-4 py-3 rounded-lg hover:bg-gray-700 transition-colors font-semibold shadow-md">
                                                        üìù Texto (.txt)
                                                    </button>
                                                ` : `
                                                    <button onclick="app.download('${this.showDocument}', 'txt')" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-md">
                                                        üíæ Descargar Documento
                                                    </button>
                                                `}
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}

                                <div class="bg-blue-50 border-l-4 border-blue-600 p-6 md:p-8 rounded-xl shadow-md">
                                    <h3 class="font-bold text-lg mb-4 text-blue-800 flex items-center">
                                        ${Icons.Check("w-5 h-5 text-blue-600 mr-2")} Instrucciones de Uso
                                    </h3>
                                    <ul class="space-y-3 text-gray-700">
                                        <li><strong>1.</strong> Descarga la Propuesta Formal (TXT) para presentar al Decano.</li>
                                        <li><strong>2.</strong> Usa el Material Informativo para explicar a estudiantes.</li>
                                        <li><strong>3.</strong> **¬°Control Digital!** Las firmas se guardan autom√°ticamente en la base de datos (pesta√±a "Registro de Firmas").</li>
                                        <li><strong>4.</strong> **¬°Exporta!** Descarga el registro de firmas en PDF, Excel o TXT para presentar la evidencia.</li>
                                    </ul>
                                </div>
                            </div>
                        ` : `
                            <!-- PESTA√ëA DE REGISTRO DE FIRMAS -->
                            <div class="space-y-8">
                                <div class="grid md:grid-cols-3 gap-6">
                                    <div class="bg-gradient-to-br from-blue-600 to-blue-700 text-white p-6 md:p-8 rounded-xl shadow-lg">
                                        <div class="text-4xl md:text-5xl font-bold">${stats.total}</div>
                                        <div class="text-lg">Total de Firmas</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-green-600 to-green-700 text-white p-6 md:p-8 rounded-xl shadow-lg">
                                        <div class="text-4xl md:text-5xl font-bold">${stats.industrial}</div>
                                        <div class="text-lg">Ing. Industrial</div>
                                    </div>
                                    <div class="bg-gradient-to-br from-purple-600 to-purple-700 text-white p-6 md:p-8 rounded-xl shadow-lg">
                                        <div class="text-4xl md:text-5xl font-bold">${stats.alimentarias}</div>
                                        <div class="text-lg">Ing. Alimentarias</div>
                                    </div>
                                </div>

                                <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border-t-4 border-blue-600">
                                    <h3 class="font-bold text-xl md:text-2xl mb-6 text-blue-800">Agregar Nueva Firma Digital</h3>
                                    <div class="grid md:grid-cols-5 gap-4 mb-6">
                                        <input type="text" id="codigo" placeholder="C√≥digo" class="px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                        <input type="text" id="nombre" placeholder="Apellidos y Nombres" class="md:col-span-2 px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                        <select id="escuela" class="px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                            <option value="Ingenier√≠a Industrial">Ingenier√≠a Industrial</option>
                                            <option value="Ingenier√≠a en Industrias Alimentarias">Ingenier√≠a en Industrias Alimentarias</option>
                                        </select>
                                        <input type="text" id="ciclo" placeholder="Ciclo" class="px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm">
                                    </div>
                                    <button onclick="app.add()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-semibold transition-colors w-full md:w-auto shadow-md">
                                        ‚ûï Registrar Firma
                                    </button>
                                </div>

                                <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                                    <table class="w-full min-w-max">
                                        <thead class="bg-gray-100 border-b-2 border-gray-200">
                                            <tr>
                                                <th class="px-6 py-4 text-left font-bold text-sm">N¬∞</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">C√≥digo</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Nombres</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Escuela</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Ciclo</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Fecha Registro</th>
                                                <th class="px-6 py-4 text-left font-bold text-sm">Acci√≥n</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${this.signatures.length === 0 ? `
                                                <tr><td colspan="7" class="px-6 py-12 text-center text-gray-500">
                                                    <div class="text-4xl md:text-5xl mb-3">üìù</div>
                                                    <p>No hay firmas registradas a√∫n. ¬°Se guardar√°n de forma persistente!</p>
                                                    <p class="text-sm mt-1">Agrega la primera firma arriba</p>
                                                </td></tr>
                                            ` : this.signatures.map((s, i) => `
                                                <tr class="border-t hover:bg-blue-50 transition-colors">
                                                    <td class="px-6 py-4 text-sm">${i+1}</td>
                                                    <td class="px-6 py-4 text-sm">${s.codigo}</td>
                                                    <td class="px-6 py-4 text-sm">${s.nombre}</td>
                                                    <td class="px-6 py-4 text-xs font-semibold ${s.escuela === 'Ingenier√≠a Industrial' ? 'text-blue-600' : 'text-green-600'}">${s.escuela}</td>
                                                    <td class="px-6 py-4 text-sm">${s.ciclo}</td>
                                                    <td class="px-6 py-4 text-xs text-gray-500">${s.timestamp.toLocaleString('es-PE', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</td>
                                                    <td class="px-6 py-4">
                                                        <button onclick="app.deleteSig('${s.id}')" class="text-red-500 hover:text-red-700 transition-colors" title="Eliminar firma">üóëÔ∏è</button>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        `}

                        <div class="mt-12 text-center text-gray-600 text-sm pb-8">
                            <p>¬© 2024 Universidad Nacional Santiago Ant√∫nez de Mayolo - UNASAM</p>
                            <p class="mt-1">Facultad de Ingenier√≠a de Industrias Alimentarias</p>
                            <p class="mt-1 text-xs text-gray-400">Datos persistentes v√≠a Firestore. ID: ${this.userId || 'Cargando...'}</p>
                        </div>
                    </div>
                `;
            }
        };

        app.init();
    </script>
</body>
</html>
